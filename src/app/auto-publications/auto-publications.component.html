<div class="auto-publications-container">
  <!-- Header -->
  <div class="header">
    <h1>üì¢ Publicaciones Autom√°ticas</h1>
    <p>Programa la publicaci√≥n autom√°tica de tus productos con variaciones de t√≠tulo</p>
  </div>

  <!-- Buscador de Productos -->
  <div class="search-card">
    <div class="search-header">
      <mat-icon>search</mat-icon>
      <h3>Agregar Producto</h3>
    </div>
    <div class="search-body">
      <div class="search-input-wrapper">
        <mat-icon class="search-icon">search</mat-icon>
        <input type="text" class="search-input" [(ngModel)]="searchQuery"
          (keyup.enter)="searchProducts()"
          placeholder="Buscar producto por nombre...">
        <button *ngIf="searchQuery" class="btn-clear-search" (click)="clearSearch()">
          <mat-icon>close</mat-icon>
        </button>
        <button class="btn-search" (click)="searchProducts()" [disabled]="isSearching">
          <mat-icon *ngIf="!isSearching">search</mat-icon>
          <mat-spinner *ngIf="isSearching" diameter="20"></mat-spinner>
        </button>
      </div>

      <!-- Search Results -->
      <div *ngIf="showSearchResults && searchResults.length > 0" class="search-results">
        <div class="search-results-header">
          Resultados ({{ searchResults.length }})
        </div>
        <div class="results-list">
          <div *ngFor="let product of searchResults" class="result-item" (click)="selectProduct(product)">
            <img *ngIf="product.thumbnail" [src]="product.thumbnail" class="result-thumbnail" alt="thumbnail">
            <div class="result-info">
              <div class="result-title">{{ product.title }}</div>
              <div class="result-meta">
                <span class="result-price">${{ product.price | number:'1.2-2' }}</span>
                <span class="result-stock">Stock: {{ product.available_quantity }}</span>
              </div>
            </div>
            <mat-icon class="result-action">chevron_right</mat-icon>
          </div>
        </div>
      </div>

      <!-- No Results -->
      <div *ngIf="showSearchResults && searchResults.length === 0 && !isSearching" class="no-results">
        No se encontraron productos
      </div>
    </div>
  </div>

  <!-- Barra de acciones -->
  <div class="actions-bar">
    <button mat-raised-button color="primary" (click)="openCreateDialog()">
      <mat-icon>add_circle</mat-icon>
      Crear Programaci√≥n
    </button>
    <button mat-raised-button (click)="loadSchedules()">
      <mat-icon>refresh</mat-icon>
      Actualizar
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Cargando programaciones...</p>
  </div>

  <!-- Tabla Material -->
  <div *ngIf="!isLoading && schedules.length > 0" class="table-container">
    <table mat-table [dataSource]="schedules" class="schedules-table">
      <!-- Producto -->
      <ng-container matColumnDef="producto">
        <th mat-header-cell *matHeaderCellDef>Producto</th>
        <td mat-cell *matCellDef="let element" class="producto-cell">
          <div class="producto-title">{{ element.originalTitle }}</div>
          <div class="producto-code">{{ element.itemId }}</div>
        </td>
      </ng-container>

      <!-- Frecuencia -->
      <ng-container matColumnDef="frecuencia">
        <th mat-header-cell *matHeaderCellDef>Frecuencia</th>
        <td mat-cell *matCellDef="let element">
          {{ element.frequency.interval }}{{ element.frequency.unit === 'hours' ? 'h' : 'd' }}
        </td>
      </ng-container>

      <!-- Variar -->
      <ng-container matColumnDef="variar">
        <th mat-header-cell *matHeaderCellDef>Variar Desc</th>
        <td mat-cell *matCellDef="let element">
          {{ element.variateDescription ? '‚úì' : '‚úó' }}
        </td>
      </ng-container>

      <!-- Pr√≥xima -->
      <ng-container matColumnDef="proxima">
        <th mat-header-cell *matHeaderCellDef>Pr√≥xima</th>
        <td mat-cell *matCellDef="let element">
          {{ element.nextPublishAt | date:'short' }}
        </td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let element">
          <span *ngIf="element.isActive" style="color: green;">‚úÖ Activo</span>
          <span *ngIf="!element.isActive" style="color: orange;">‚è∏Ô∏è Pausado</span>
        </td>
      </ng-container>

      <!-- Total Pub -->
      <ng-container matColumnDef="total">
        <th mat-header-cell *matHeaderCellDef>Total Pub</th>
        <td mat-cell *matCellDef="let element">{{ element.publicationCount }}</td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let element" class="actions-cell">
          <div class="action-buttons">
            <button mat-icon-button matTooltip="Ver historial" (click)="openHistoryDialog(element)">
              <mat-icon>history</mat-icon>
            </button>
            <button mat-icon-button matTooltip="Editar" (click)="openEditDialog(element)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button matTooltip="Publicar ahora" (click)="publishNow(element)">
              <mat-icon>publish</mat-icon>
            </button>
            <button mat-icon-button matTooltip="Eliminar" (click)="deleteSchedule(element)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <!-- Empty state -->
  <div *ngIf="!isLoading && schedules.length === 0" class="empty-state">
    <mat-icon>schedule</mat-icon>
    <h2>No hay programaciones</h2>
    <p>Crea tu primera programaci√≥n de publicaci√≥n autom√°tica</p>
    <button mat-raised-button color="primary" (click)="openCreateDialog()">
      Crear Programaci√≥n
    </button>
  </div>

  <!-- Info cards -->
  <div class="info-cards">
    <mat-card>
      <mat-card-content>
        <div class="card-title">üìä Total Programaciones</div>
        <div class="card-value">{{ schedules.length }}</div>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-content>
        <div class="card-title">‚úÖ Activas</div>
        <div class="card-value">{{ getActiveCount() }}</div>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-content>
        <div class="card-title">‚è∏Ô∏è Pausadas</div>
        <div class="card-value">{{ getPausedCount() }}</div>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-content>
        <div class="card-title">üì¶ Total Publicaciones</div>
        <div class="card-value">{{ getTotalPublications() }}</div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
