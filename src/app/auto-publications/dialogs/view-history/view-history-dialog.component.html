<h2 mat-dialog-title>üìä Historial: {{ data.schedule.originalTitle }}</h2>

<mat-dialog-content>
  <!-- Info Schedule -->
  <div class="schedule-info">
    <div class="info-item">
      <strong>Programaci√≥n activa:</strong>
      <span [style.color]="data.schedule.isActive ? 'green' : 'orange'">
        {{ data.schedule.isActive ? '‚úÖ Activa' : '‚è∏Ô∏è Pausada' }}
      </span>
    </div>
    <div class="info-item">
      <strong>Pr√≥xima publicaci√≥n:</strong>
      <span>{{ formatDate(data.schedule.nextPublishAt) }}</span>
    </div>
    <div class="info-item">
      <strong>Total publicaciones:</strong>
      <span>{{ history.length }}</span>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    <mat-spinner diameter="30"></mat-spinner>
    <p>Cargando historial...</p>
  </div>

  <!-- History List -->
  <div *ngIf="!isLoading" class="history-list">
    <div *ngIf="history.length === 0" class="empty">
      <p>üì≠ No hay historial de publicaciones</p>
    </div>

    <mat-card *ngFor="let item of history; let i = index" class="history-item">
      <div class="history-header">
        <div class="history-number">#{{ i + 1 }}</div>
        <div class="history-status" [style.color]="getStatusColor(item.status)">
          {{ getStatusIcon(item.status) }} {{ item.status === 'success' ? 'Exitosa' : item.status === 'failed' ? 'Fallida' : 'Pendiente' }}
        </div>
        <div class="history-date">{{ formatDate(item.publishedAt) }}</div>
      </div>

      <div class="history-body">
        <div class="title-field">
          <strong>T√≠tulo publicado:</strong>
          <p>{{ item.publishedTitle }}</p>
        </div>

        <div *ngIf="item.newListingId" class="listing-field">
          <strong>ID de publicaci√≥n:</strong>
          <a [href]="'https://articulo.mercadolibre.com.mx/' + item.newListingId" target="_blank">
            ML-{{ item.newListingId }}
            <mat-icon>open_in_new</mat-icon>
          </a>
        </div>

        <div *ngIf="item.errorMessage" class="error-field">
          <strong>Error:</strong>
          <p>{{ item.errorMessage }}</p>
        </div>
      </div>
    </mat-card>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onClose()">Cerrar</button>
</mat-dialog-actions>
